# Live Coding for the AWS Amplify document manager  MVP

### Getting Set Up 

THe thing we need to do is to make sure we have the proper configuration to deploy React.js apps in our IDE

#### Getting npm and react installed

```bash
$ npm install -g @aws-amplify/cli
```

#### Getting the AWS AMplify CLI installed

### Creating the Application and the AWS Amplify configuration

#### Starting a new react app

We can either create an empty project as follows:

```bash
$ cd ~/environment/
$ npx create-react-app documentmanager && cd documentmanager && npm install
```

OR we can pull down the latest code from github if we want the final project

```bash
$ cd ~/environment/
$ git clone https://github.com/MiltyBrizan/documentmanager.git && cd documentmanager
```

#### Initialize AWS Amplify

```bash
$ amplify init
```

And use all of the defaults.

## Adding amplify features

### Authentication

The first thing we need to add to our applicaiton is authenitication. 

```bash
$ amplify add auth
```

Make sure to select cognito as your source and use all of the defaults (we can change this later if needed). Then, we can push our changes over using:

```bash
$ amplify push
```

We can have a look at the *aws-exports.js* in the root folder to see a list of resource that are available to us.

Lets start out by makingf sure we're importing the libraries we need in App.js

```JavaScript
import React from "react";
import logo from './logo.svg';
import './App.css';
import Amplify from 'aws-amplify';
import  Auth , { AmplifySignOut, withAuthenticator } from '@aws-amplify/ui-react';
import awsconfig from './aws-exports';
```

Let's tell Amplify which configuration we want to use:

```JavaScript
Amplify.configure(awsconfig);
```

Next, we can remove everything inside of the header in the function App() {} of App.js. The function should look like this:

```JavaScript
function App() {
  return (
    <div className="App">
      <header className="App-header">
        <AmplifySignOut />
        <h2>Documents</h2>
      </header>
    </div>
  );
}
```

Finally, lets enclose the app with authentication by replacing the default export:

```JavaScript
export default withAuthenticator(App, false);
```

In the shell, we need ot make sure we've imported all of the modules we need:

```bash
npm install --save aws-amplify @aws-amplify/ui-react
```

Now lets start the application and see if we have :

```bash
$ npm start
```

Nice! We now have authentication.

## Adding an API using GraphQL (via AWS AppSync)

Let add in an API, NoSQL or SQL Databases, and resolvers that can fetch data for us. And also, we can autoi generate code.

```bash
$ amplify add api
```

Make sure to select GraphQL and use the defaults. Make sure to select Cognito User Pools.

Now, select done, make sure to pick that you DO NOT have an existing schema. Then selct Single Object with feilds. This then sets up some code for us onm the backend. and then select that you do want to edit your schema.


THe schema should open up in a standard text editor.

Since we are makind a simple document management schema, we should update the model to be more reflective of what we want to capture:

```JavaScript
type Document @model {
  id: ID!
  title: String!
  description: String!
  filePath: String!
  approved: Boolean!
  owner: String!
}
```


Now we push the config:

```bash
$ amplify push
```

Lets elect to have code autogenerated for us. Make sure to select all of the defaults and the data will get pushed up to AWS.

Now let't go back to our App.js and add some code to this to work with our new Documents API:

Right now, lets rename the App.js to App.jsx to work better with oyut templating engine. This step is actuall optional.

```bash
$ mv App.js App.jsx
```

Now lets add some functionality above the return function so we can query our data:

Let's add in the and import for the API module of amplify

```JavaScript
import Amplify, {API} from 'aws-amplify';
```

Let's also add in a fuction to fetch those documents. We'll wrap that in a try catch block to protect ourslves.

Notice we are markinng this as an async operation. This means that we can specify that this data will wait for acknowledgement before running.
We are using the graphqlOperation(function) which takes an operation as a paramenter; (listDocuments) was auto generated for us whenw e created our model (src/graphql/queries.js).

we still need to import that function though: 

```JavaScript
import {listDocuments} from './graphql/queries';
import Amplify,  {API, graphqlOperation}  from 'aws-amplify';
```

We also want to use state in our react app, so we shoudl improt that as well:


```JavaScript
import { useState} from 'react';
```

Lets also make a value for our state and a function refrence for setting that document state:

```JavaScript
const [documets, setDocuments]  = useState([]);
```

We also need a function to retrive the data:

under function App(){
.....
```JavaScript
  const [documets, setDocuments]  = useState([]);

  useEffect(() => {
    fetchDocuments();
  }, [])
  
  const fetchDocuments = async () => {
    try{
      const documentData = await API.graphql(graphqlOperation(listDocuments));
      const documentList = documentData.data.listDocuments.items;
  
      console.log('document list', documentList);
      setDocuments(documentList);
    }  catch (error) {
      console.log('Error on fetching data', error);
    }
  }
  ```
  
  
We can use the layout of our schema to generate some sample data into Dynamo ... but we have to convert that data into proper JSON format.

Use the following sample data to insert into Dynamo table:
  
  
  ```json
{
  "id": "miltytest",
  "title":  "The boy who creied document",
  "description": "A test document for our app",
  "filePath": "",
  "approved": false,
  "owner": "Milton Brizan",
  "createdAt": "2021-05-20T07:01:38.935Z",
  "updatedAt": "2021-05-20T07:01:38.935Z"
}
```

After you hit save and go back to the developer console fo the app .... yoiu shouild be ale to see actual data!.

In the next step, lets add in code to display all of our documents.

### going back to App,jsx

We are going to be using materiel viw to amke individuakl cards for the applicaiotns"

```bash
$ npm install --save @material-ui/core @material-ui/icons
```
While thats installing, lets take a look at https://material-ui.com/. Yoiu can see here it's easy to install and then leverage components. It makes creating attractive applicaitons even easier. And trust me, i need it!

Now we will add a new div under the header of the return function

......
